# OpenID Connect Demo

–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç OpenID Connect —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `oidc-provider` –∏ npm workspaces.

> üìñ **–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:** [docs/AUTH_CONCEPT.md](./docs/AUTH_CONCEPT.md)

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

- **`packages/auth-service`** - OIDC Auth Service (Provider + Client, –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä)
  - OIDC Provider (–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä):
    - –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    - –°–ø–∏—Å–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (clients)
    - –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å -> –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -> —Ä–æ–ª—å
    - –í—ã–¥–∞–µ—Ç JWT —Ç–æ–∫–µ–Ω—ã —Å —Ä–æ–ª—å—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  - OIDC Client —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
    - –û–±—Ä–∞–±–æ—Ç–∫–∞ OIDC flow –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
    - –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ session ID
    - Endpoint `/api/token` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
    - Endpoint `/client/auth` –¥–ª—è –Ω–∞—á–∞–ª–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    - Endpoint `/client/callback` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ callback

- **`packages/admin-backend`** - Admin Backend API —Å JWT –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
  - Middleware –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ JWT —Ç–æ–∫–µ–Ω–æ–≤
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ endpoints

- **`packages/admin-ui`** - Admin UI –Ω–∞ Vue.js 3 (Composition API)
  - –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å admin-backend API
  - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ OIDC
  - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ, –ø—Ä–æ—Å–º–æ—Ç—Ä)
  - –î–æ—Å—Ç—É–ø –∫ admin endpoints (–¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—å—é admin)

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
npm install
```

## –ó–∞–ø—É—Å–∫

### –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

```bash
npm run start:all
```

–ò–ª–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π:

```bash
npm run dev:all
```

### –ó–∞–ø—É—Å–∫ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# Auth Service (–ø–æ—Ä—Ç 3000) - OIDC Provider + Client (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä)
npm run start:auth-service

# Admin Backend (–ø–æ—Ä—Ç 3002) - –≤–∫–ª—é—á–∞–µ—Ç Admin UI –ø–æ—Å–ª–µ –±–∏–ª–¥–∞
npm run build:admin-ui  # –°–Ω–∞—á–∞–ª–∞ —Å–æ–±—Ä–∞—Ç—å admin-ui –≤ admin-backend/public
npm run start:admin-backend

# Admin UI (dev —Ä–µ–∂–∏–º, –ø–æ—Ä—Ç 3003)
npm run dev:admin-ui
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. –°–æ–±–µ—Ä–∏—Ç–µ admin-ui: `npm run build:admin-ui`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã: `npm run start:all`
3. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞:
   - `http://localhost:3002` - Admin UI (—Ä–∞–∑–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ admin-backend)
4. –í—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞ provider
4. –í–æ–π–¥–∏—Ç–µ —Å –æ–¥–Ω–∏–º –∏–∑ —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Å–º. –Ω–∏–∂–µ)
5. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ JWT —Ç–æ–∫–µ–Ω —Å —Ä–æ–ª—å—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —ç—Ç–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
6. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–∫–µ–Ω –¥–ª—è –≤—ã–∑–æ–≤–∞ admin-backend API –∏–ª–∏ —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ Admin UI

## –¢–µ—Å—Ç–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏

- `user1` / `pass1` - —Ä–æ–ª—å `user` –≤ `demo-client` –∏ `admin-ui`
- `user2` / `pass2` - —Ä–æ–ª—å `admin` –≤ `demo-client` –∏ `admin-ui`
- `admin` / `admin` - —Ä–æ–ª—å `admin` –≤–æ –≤—Å–µ—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö

## –ú–∞–ø–ø–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ä–æ–ª–µ–π

–ù–∞—Å—Ç—Ä–æ–µ–Ω –≤ `packages/provider/index.js`:

```javascript
const userAppRoles = {
  'user1': {
    'demo-client': 'user',
  },
  'user2': {
    'demo-client': 'admin',
  },
  'admin': {
    'demo-client': 'admin',
  },
};
```

## URL –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞

–ö–∞–∂–¥–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Å–≤–æ–π URL –¥–ª—è –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏–∏ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ª–æ–≥–∏–Ω–∞. –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤ `packages/auth-service/index.js`:

```javascript
const applications = [
  { 
    client_id: 'demo-client', 
    name: 'Demo Application', 
    secret: 'demo-secret',
    redirect_url: 'http://localhost:3001/', // URL –¥–ª—è –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏–∏ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ª–æ–≥–∏–Ω–∞
  },
];
```

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—É–¥–µ—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ —ç—Ç–æ—Ç URL —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `session`, —Å–æ–¥–µ—Ä–∂–∞—â–∏–º session ID –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç–æ–∫–µ–Ω—É.

## Admin Backend API

Admin Backend –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:3002`:
- **Admin UI** - `http://localhost:3002` (–ø–æ—Å–ª–µ –±–∏–ª–¥–∞ admin-ui)
- **API** - –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å `/api`

### API Endpoints

- `GET /api/health` - –ü—É–±–ª–∏—á–Ω—ã–π health check
- `GET /api/user` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ (—Ç—Ä–µ–±—É–µ—Ç JWT)
- `GET /api/admin` - –¢–æ–ª—å–∫–æ –¥–ª—è admin (—Ç—Ä–µ–±—É–µ—Ç JWT + —Ä–æ–ª—å admin)
- `GET /api/data` - –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ç—Ä–µ–±—É–µ—Ç JWT + —Ä–æ–ª—å admin –∏–ª–∏ user)
- `POST /api/data` - –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (—Ç—Ä–µ–±—É–µ—Ç JWT + —Ä–æ–ª—å admin –∏–ª–∏ user)

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```bash
# –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
curl -H "Authorization: Bearer <JWT_TOKEN>" http://localhost:3002/api/user

# –î–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è admin
curl -H "Authorization: Bearer <JWT_TOKEN>" http://localhost:3002/api/admin

# –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
curl -H "Authorization: Bearer <JWT_TOKEN>" http://localhost:3002/api/data
```

## Flow –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

1. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Admin UI) —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ **Auth Service** —á–µ—Ä–µ–∑ `/client/auth?client_id=...`
2. **Auth Service** (OIDC Client —á–∞—Å—Ç—å) –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç OIDC flow –∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ **Auth Service** (OIDC Provider —á–∞—Å—Ç—å) –¥–ª—è –ª–æ–≥–∏–Ω–∞
3. **Auth Service** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º—É –ª–æ–≥–∏–Ω–∞
4. –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ª–æ–≥–∏–Ω–∞ **Auth Service**:
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –º–∞–ø–ø–∏–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å -> –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -> —Ä–æ–ª—å
   - –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é, —Å–æ–∑–¥–∞–µ—Ç JWT —Å —Ä–æ–ª—å—é
   - –†–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ **Auth Service** (Client —á–∞—Å—Ç—å) –Ω–∞ `/client/callback` —Å authorization code
5. **Auth Service** (Client —á–∞—Å—Ç—å) –æ–±–º–µ–Ω–∏–≤–∞–µ—Ç code –Ω–∞ JWT —Ç–æ–∫–µ–Ω
6. **Auth Service** —Ä–µ–¥–∏—Ä–µ–∫—Ç–∏—Ç –Ω–∞ `redirect_url` –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å —Ç–æ–∫–µ–Ω–æ–º –≤ query –ø–∞—Ä–∞–º–µ—Ç—Ä–µ
8. –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ **Admin Backend** –∏–¥—É—Ç —Å JWT –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer <token>`
9. **Admin Backend** –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç JWT —á–µ—Ä–µ–∑ middleware:
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç issuer –∏ audience
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
10. –ï—Å–ª–∏ JWT –≤–∞–ª–∏–¥–µ–Ω - –∑–∞–ø—Ä–æ—Å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è, –∏–Ω–∞—á–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è 401

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **–ù–µ—Ç —ç–∫—Ä–∞–Ω–∞ —Å–æ–≥–ª–∞—Å–∏—è (consent)** - –¥–æ—Å—Ç—É–ø –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –º–∞–ø–ø–∏–Ω–≥–æ–º —Ä–æ–ª–µ–π
- **–†–æ–ª—å –≤ JWT** - –∫–∞–∂–¥—ã–π JWT —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **Stateless –≤–∞–ª–∏–¥–∞—Ü–∏—è** - admin-backend –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç JWT –±–µ–∑ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ auth-service
- **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π** - middleware –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–æ–ª–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ endpoints

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **oidc-provider** - OIDC Provider –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è Node.js
- **openid-client** - OIDC Client –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è Node.js
- **Express** - Web framework –¥–ª—è Node.js
- **npm workspaces** - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–æ–Ω–æ—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

–≠—Ç–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è OpenID Connect. –î–ª—è production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –º–∞–ø–ø–∏–Ω–≥–∞ —Ä–æ–ª–µ–π (–ë–î)
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å HTTPS
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —Ç–æ–∫–µ–Ω–æ–≤
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å refresh token flow
- –î–æ–±–∞–≤–∏—Ç—å rate limiting